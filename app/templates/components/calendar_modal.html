<!-- CALENDAR MODAL -->
<div id="calendarModal"
	class="fixed inset-0 z-[80] flex items-center justify-center bg-zinc-500/30 dark:bg-black/90 backdrop-blur-md hidden opacity-0 transition-opacity duration-200"
	onclick="if(event.target === this) closeCalendarModal()">
	<div class="bg-white dark:bg-[#0c0c0e] border border-zinc-200 dark:border-zinc-800 rounded-3xl w-full max-w-[95%] h-[90vh] overflow-hidden flex flex-col shadow-2xl transform scale-95 transition-all duration-200 animate-enter"
		id="calendarModalContent">

		<!-- Header -->
		<div
			class="px-6 py-5 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between bg-white dark:bg-[#0c0c0e] relative">

			<!-- Left: Quick Navigation -->
			<div class="flex items-center w-1/3">
				<button id="btnCalToday" onclick="goToToday()"
					class="px-4 py-2 text-sm font-bold text-emerald-600 dark:text-emerald-400 bg-emerald-50 dark:bg-emerald-950/30 rounded-xl border border-emerald-200 dark:border-emerald-800 hover:bg-emerald-100 dark:hover:bg-emerald-950/50 transition-all flex items-center gap-2">
					<i data-lucide="calendar" class="w-4 h-4"></i>
					<span>Today</span>
				</button>
			</div>

			<!-- Center: Month Navigation (Visible in Month View only) -->
			<div id="monthNavNew" style="display: none;" class="items-center justify-center gap-2 w-1/3">
				<button onclick="navigateMonth(-1)"
					class="p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all">
					<i data-lucide="chevron-left" class="w-5 h-5"></i>
				</button>
				<h3 id="calendarMonthLabel" onclick="openMonthYearPicker()"
					class="text-lg font-heading font-bold text-zinc-800 dark:text-white hover:text-emerald-500 dark:hover:text-emerald-400 cursor-pointer transition-colors select-none min-w-[140px] text-center">
					--
				</h3>
				<button onclick="navigateMonth(1)"
					class="p-1.5 rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-800 text-zinc-400 hover:text-zinc-900 dark:hover:text-white transition-all">
					<i data-lucide="chevron-right" class="w-5 h-5"></i>
				</button>
			</div>

			<!-- Right: View Modes & Close -->
			<div class="flex items-center justify-end gap-3 shrink-0 w-1/3">
				<div
					class="flex p-1 rounded-xl bg-zinc-100 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 shrink-0">
					<button id="calViewMonth" onclick="setCalendarView('month')"
						class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all bg-zinc-900 dark:bg-white text-white dark:text-black shadow-sm">
						Month
					</button>
					<button id="calViewUpcoming" onclick="setCalendarView('upcoming')"
						class="px-4 py-1.5 rounded-lg text-xs font-bold transition-all text-zinc-500 hover:text-zinc-900 dark:hover:text-white">
						Upcoming
					</button>
				</div>

				<div class="h-8 w-px bg-zinc-200 dark:bg-zinc-800 mx-1"></div>

				<button onclick="closeCalendarModal()"
					class="p-2 rounded-xl text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all">
					<i data-lucide="x" class="w-5 h-5"></i>
				</button>
			</div>
		</div>

		<!-- Main Content -->
		<div class="flex-1 overflow-hidden relative">
			<!-- Month View Layout -->
			<div id="calendarMonthView" class="h-full flex flex-col absolute inset-0 z-10 bg-white dark:bg-[#0c0c0e]">
				<div class="flex-1 overflow-y-auto custom-scrollbar p-6">
					<!-- Weekday headers -->
					<div class="grid grid-cols-7 gap-3 mb-3">
						<div class="text-center text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Mon</div>
						<div class="text-center text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Tue</div>
						<div class="text-center text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Wed</div>
						<div class="text-center text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Thu</div>
						<div class="text-center text-[11px] font-bold text-zinc-400 uppercase tracking-wider">Fri</div>
						<div class="text-center text-[11px] font-bold text-amber-500 uppercase tracking-wider">Sat</div>
						<div class="text-center text-[11px] font-bold text-red-500 uppercase tracking-wider">Sun</div>
					</div>
					<!-- Grid populated by calendar.js -->
					<div id="calendarDaysGrid" class="grid grid-cols-7 gap-3 pb-6"></div>
				</div>
			</div>

			<!-- Upcoming View Layout -->
			<div id="calendarUpcomingView"
				class="h-full flex flex-col hidden absolute inset-0 z-10 bg-white dark:bg-[#0c0c0e]">
				<div id="calendarUpcomingList"
					class="flex-1 overflow-x-auto custom-scrollbar p-6 flex items-start gap-8">
					<!-- Items populated by calendar.js -->
				</div>
			</div>
		</div>

		<!-- Activity Sidebar (Day Detail) -->
		<div id="calendarDayDetail"
			class="absolute inset-y-0 right-0 w-80 bg-white dark:bg-zinc-900 border-l border-zinc-200 dark:border-zinc-800 transform translate-x-full transition-transform duration-300 z-10 flex flex-col hidden shadow-2xl">
			<div class="p-4 border-b border-zinc-200 dark:border-zinc-800 flex items-center justify-between">
				<h4 id="dayDetailDate" class="font-heading font-bold text-zinc-900 dark:text-white">--</h4>
				<button onclick="closeDayDetail()"
					class="p-1.5 rounded-lg text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all">
					<i data-lucide="x" class="w-4 h-4"></i>
				</button>
			</div>
			<div id="dayDetailContent" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3"></div>
		</div>

		<!-- Action Trigger -->
		<button onclick="openAddEventModal()"
			class="absolute bottom-8 right-40 z-50 px-6 py-3 bg-zinc-900 dark:bg-white hover:bg-zinc-700 dark:hover:bg-zinc-200 text-white dark:text-black rounded-full text-sm font-bold transition-all shadow-2xl hover:scale-105 active:scale-95 flex items-center gap-2 group translate-x-1/2">
			<i data-lucide="plus" class="w-5 h-5 group-hover:rotate-90 transition-transform"></i>
			<span>Add Release</span>
		</button>

		<!-- Date Selection Overlay -->
		<div id="monthYearPicker"
			class="absolute inset-0 bg-white/95 dark:bg-zinc-950/95 backdrop-blur-xl z-20 hidden flex-col items-center justify-center">
			<div class="w-full max-w-md p-8 space-y-6">
				<h3 class="text-xl font-heading font-bold text-center text-zinc-900 dark:text-white">Select Month & Year
				</h3>
				<div class="flex items-center justify-center gap-4">
					<button onclick="changePickerYear(-1)"
						class="p-2 rounded-xl bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all">
						<i data-lucide="chevron-left" class="w-5 h-5 text-zinc-600 dark:text-zinc-400"></i>
					</button>
					<span id="pickerYearLabel"
						class="text-2xl font-bold text-zinc-900 dark:text-white w-24 text-center">--</span>
					<button onclick="changePickerYear(1)"
						class="p-2 rounded-xl bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all">
						<i data-lucide="chevron-right" class="w-5 h-5 text-zinc-600 dark:text-zinc-400"></i>
					</button>
				</div>
				<div id="pickerMonthGrid" class="grid grid-cols-4 gap-2"></div>
				<button onclick="closeMonthYearPicker()"
					class="w-full py-3 rounded-xl bg-zinc-100 dark:bg-zinc-800 text-zinc-600 dark:text-zinc-400 font-bold text-sm hover:bg-zinc-200 dark:hover:bg-zinc-700 transition-all">
					Cancel
				</button>
			</div>
		</div>
	</div>
</div>

<!-- ENTRY FORM MODAL -->
<div id="addEventModal"
	class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/60 backdrop-blur-md animate-enter p-4"
	onclick="if(event.target === this) closeAddEventModal()">
	<div
		class="bg-white dark:bg-[#121214] border border-zinc-200 dark:border-zinc-800 rounded-3xl w-full max-w-lg shadow-2xl overflow-hidden flex flex-col max-h-[85vh] transition-all transform scale-100">

		<!-- Simple Clean Header -->
		<div class="px-8 pt-8 pb-4 flex items-center justify-between shrink-0">
			<div>
				<h3 id="addEventModalTitle" class="text-2xl font-bold tracking-tight text-zinc-900 dark:text-white">Add
					Release</h3>
				<p class="text-sm text-zinc-500 dark:text-zinc-400 mt-1">Track a new anime, manga, or TV show.</p>
			</div>
			<button onclick="closeAddEventModal()"
				class="p-2 -mr-2 rounded-full text-zinc-400 hover:text-zinc-900 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all">
				<i data-lucide="x" class="w-6 h-6"></i>
			</button>
		</div>

		<!-- Scrollable Content -->
		<div class="px-8 pb-4 overflow-y-auto custom-scrollbar flex-1 space-y-8">

			<!-- SECTION 1: What -->
			<div class="space-y-4">
				<div class="relative group z-30">
					<label class="block text-xs font-bold text-zinc-400 uppercase tracking-wider mb-2">Search
						Media</label>
					<div class="relative">
						<i data-lucide="search"
							class="absolute left-4 top-3.5 w-5 h-5 text-zinc-400 group-focus-within:text-emerald-500 transition-colors"></i>
						<input type="text" id="addEventSearch" placeholder="Search for anime, manga..."
							oninput="searchMediaItems(this.value)" autocomplete="off"
							class="w-full pl-12 pr-4 py-3 bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700/50 rounded-2xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all font-medium text-zinc-900 dark:text-white placeholder-zinc-400">

						<!-- Dropdown Results -->
						<div id="addEventSuggestions"
							class="absolute left-0 right-0 top-full mt-2 bg-white dark:bg-zinc-900 border border-zinc-100 dark:border-zinc-800 rounded-2xl shadow-xl max-h-60 overflow-y-auto hidden divide-y divide-zinc-50 dark:divide-zinc-800/50 transform origin-top transition-all">
						</div>
					</div>

					<!-- Selected Item Card (Premium Refactor) -->
					<div id="addEventSelectedItem"
						class="hidden mt-4 relative overflow-hidden group/card bg-zinc-50 dark:bg-zinc-900/30 border border-zinc-100 dark:border-zinc-800 rounded-2xl p-4 transition-all hover:border-emerald-500/30">
						<div class="flex gap-4 relative z-10">
							<div class="relative shrink-0">
								<img id="selectedItemCover" src=""
									class="w-16 h-24 rounded-lg object-cover shadow-md bg-zinc-200 dark:bg-zinc-800">
								<div
									class="absolute inset-0 rounded-lg ring-1 ring-inset ring-black/10 dark:ring-white/10">
								</div>
							</div>
							<div class="flex-1 min-w-0 flex flex-col justify-center">
								<h4 id="selectedItemTitle"
									class="font-bold text-lg text-zinc-900 dark:text-white truncate leading-tight mb-1">
								</h4>
								<span id="selectedItemType"
									class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-emerald-100 dark:bg-emerald-900/30 text-emerald-700 dark:text-emerald-400 w-fit"></span>
								<div class="mt-2 flex items-center gap-2">
									<button onclick="clearSelectedMediaItem()"
										class="text-xs font-bold text-red-500 hover:text-red-600 hover:underline">Remove</button>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Manual Description -->
				<div class="space-y-2">
					<label
						class="block text-xs font-bold text-zinc-400 uppercase tracking-wider mb-2">Description</label>
					<input type="text" id="addEventContent" placeholder="e.g. Season 2 Premiere, Chapter 105..."
						class="w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700/50 rounded-2xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all font-medium text-zinc-900 dark:text-white placeholder-zinc-400">
				</div>
			</div>

			<!-- SECTION 2: When -->
			<div class="space-y-2">
				<label class="block text-xs font-bold text-zinc-400 uppercase tracking-wider mb-2">Timing</label>
				<div class="grid grid-cols-2 gap-4">
					<div class="relative">
						<input type="date" id="addEventDate" required
							class="w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700/50 rounded-2xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all font-medium text-zinc-900 dark:text-white dark:[color-scheme:dark]">
					</div>
					<div class="relative">
						<input type="time" id="addEventTime"
							class="w-full px-4 py-3 bg-zinc-50 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-700/50 rounded-2xl focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-500 outline-none transition-all font-medium text-zinc-900 dark:text-white dark:[color-scheme:dark]">
					</div>
				</div>
			</div>

			<!-- SECTION 3: Recurrence (Seamless Integration) -->
			<div class="space-y-0">
				<div class="flex items-center justify-between py-2 group cursor-pointer"
					onclick="document.getElementById('addEventRecur').click()">
					<div class="flex items-center gap-3">
						<div
							class="p-2 rounded-lg bg-zinc-100 dark:bg-zinc-800 text-zinc-500 dark:text-zinc-400 group-hover:text-emerald-500 group-hover:bg-emerald-50 dark:group-hover:bg-emerald-900/20 transition-colors">
							<i data-lucide="repeat" class="w-5 h-5"></i>
						</div>
						<div>
							<h4 class="font-bold text-zinc-900 dark:text-white text-sm">Recurring Release</h4>
							<p class="text-xs text-zinc-500">Repeat weekly or daily</p>
						</div>
					</div>
					<label class="relative inline-flex items-center cursor-pointer pointer-events-none">
						<!-- Pointer events none to let parent click handle it -->
						<input type="checkbox" id="addEventRecur" class="sr-only peer"
							onchange="toggleRecurrence(this.checked); event.stopPropagation();">
						<div
							class="w-11 h-6 bg-zinc-200 dark:bg-zinc-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
						</div>
					</label>
				</div>

				<div id="recurrenceOptions"
					class="hidden pl-4 pt-4 space-y-4 border-l-2 border-dashed border-zinc-200 dark:border-zinc-800 ml-5">
					<div class="grid grid-cols-2 gap-4">
						<div class="space-y-1">
							<label class="text-xs font-bold text-zinc-500 ml-1">Frequency</label>
							<select id="recurrenceFreq" disabled
								class="w-full px-4 py-2 bg-white dark:bg-black border border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-2 focus:ring-emerald-500/20 outline-none text-sm font-medium transition-all">
								<option value="weekly">Weekly</option>
								<option value="daily">Daily</option>
							</select>
						</div>
						<div class="space-y-1">
							<label class="text-xs font-bold text-zinc-500 ml-1">Count</label>
							<input type="number" id="recurrenceCount" value="12" min="1" max="52" disabled
								class="w-full px-4 py-2 bg-white dark:bg-black border border-zinc-200 dark:border-zinc-800 rounded-xl focus:ring-2 focus:ring-emerald-500/20 outline-none text-sm font-medium transition-all">
						</div>
					</div>

					<div class="space-y-3">
						<div class="flex items-center justify-between">
							<span class="text-sm font-medium text-zinc-700 dark:text-zinc-300 transition-colors">Add
								episode numbers</span>
							<label class="relative inline-flex items-center cursor-pointer">
								<input type="checkbox" id="recurrenceUseCounter" checked disabled class="sr-only peer"
									onchange="document.getElementById('startCountContainer').classList.toggle('opacity-50', !this.checked); document.getElementById('recurrencePrefix').disabled = !this.checked; document.getElementById('recurrenceStartCount').disabled = !this.checked;">
								<div
									class="w-11 h-6 bg-zinc-200 dark:bg-zinc-700 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-emerald-500">
								</div>
							</label>
						</div>

						<div id="startCountContainer" class="flex items-center gap-3 transition-opacity">
							<input type="text" id="recurrencePrefix" placeholder="Prefix (e.g. Ep)" disabled
								class="flex-1 min-w-0 px-3 py-2 bg-white dark:bg-black border border-zinc-200 dark:border-zinc-800 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all">
							<input type="number" id="recurrenceStartCount" value="1" min="1" disabled
								class="w-20 px-3 py-2 bg-white dark:bg-black border border-zinc-200 dark:border-zinc-800 rounded-xl text-sm focus:ring-2 focus:ring-emerald-500/20 outline-none transition-all text-center">
						</div>
					</div>
				</div>
			</div>


		</div>

		<!-- Footer Action Bar -->
		<div
			class="p-6 pt-2 shrink-0 flex items-center justify-between gap-4 bg-gradient-to-t from-white via-white to-transparent dark:from-[#121214] dark:via-[#121214] z-20">
			<button id="btnDeleteEvent" onclick="deleteEvent()"
				class="hidden px-4 py-2 text-sm font-bold text-red-500 hover:text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition-all">
				Delete Release
			</button>
			<div class="flex items-center gap-3 ml-auto w-full sm:w-auto">
				<button onclick="closeAddEventModal()"
					class="px-6 py-2.5 rounded-xl text-sm font-bold text-zinc-500 hover:text-zinc-800 dark:text-zinc-400 dark:hover:text-white hover:bg-zinc-100 dark:hover:bg-zinc-800 transition-all">
					Cancel
				</button>
				<button onclick="submitNewEvent()"
					class="flex-1 sm:flex-none px-8 py-2.5 bg-zinc-900 hover:bg-zinc-800 dark:bg-white dark:hover:bg-zinc-200 text-white dark:text-black font-bold rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-2 text-sm">
					<span id="btnAddEventLabel">Add Release</span>
					<i data-lucide="arrow-right" class="w-4 h-4"></i>
				</button>
			</div>
		</div>

	</div>
</div>
</div>