<!-- ENTRY WIZARD MODAL -->
<div id="modal"
	class="fixed inset-0 z-[100] flex items-center justify-center bg-zinc-500/30 dark:bg-black/90 backdrop-blur-md hidden opacity-0 transition-opacity duration-200"
	onclick="if(event.target === this) closeModal()">
	<div class="bg-white dark:bg-[#0c0c0e] border border-zinc-200 dark:border-zinc-800 rounded-3xl w-full max-w-2xl h-[650px] max-h-[90vh] overflow-hidden flex flex-col shadow-2xl transform scale-95 transition-all duration-200 animate-enter"
		id="modalContent">

		<!-- Modal Header -->
		<div
			class="px-8 py-6 border-b border-zinc-200 dark:border-zinc-800 flex justify-between items-center bg-white dark:bg-[#0c0c0e] relative">
			<h2 class="text-xl font-heading font-bold text-zinc-900 dark:text-white tracking-wide mx-auto"
				id="modalTitle">New Entry
			</h2>
			<button onclick="closeModal()"
				class="absolute right-8 text-zinc-400 hover:text-red-500 dark:hover:text-white transition-colors">
				<i data-lucide="x" class="w-5 h-5"></i>
			</button>
		</div>

		<div class="flex flex-1 overflow-hidden relative">
			<!-- Navigation Sidebar (Edit Mode Only) -->
			<div id="editSidebar"
				class="hidden w-64 shrink-0 bg-white dark:bg-[#0c0c0e] border-r border-zinc-200 dark:border-zinc-800 flex-col overflow-y-auto custom-scrollbar py-6 pl-6 pr-2">
				<nav class="space-y-1" id="editSidebarNav"></nav>
			</div>

			<div id="formScrollWrapper"
				class="p-8 overflow-y-auto custom-scrollbar flex-1 bg-zinc-50 dark:bg-zinc-950/30 scroll-smooth">
				<form id="entryForm" class="h-full relative overflow-hidden" onsubmit="return false;">

					<!-- Step 1: Media Type -->
					<div id="step-1"
						class="wizard-step absolute inset-0 p-6 flex flex-col items-center justify-center text-center space-y-4 overflow-hidden">
						<h3
							class="edit-only-header hidden text-lg font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-4">
							Media Type</h3>
						<div class="w-full h-full flex flex-col pb-2">
							<input type="hidden" id="type">
							<div id="typeSelectionContainer" class="w-full h-full"></div>
						</div>
					</div>

					<!-- Step 2: Status -->
					<div id="step-2"
						class="wizard-step absolute inset-0 p-6 flex flex-col items-center justify-center text-center space-y-4 hidden overflow-hidden">
						<h3
							class="edit-only-header hidden text-lg font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-4">
							Status</h3>
						<input type="hidden" id="status">
						<div id="statusSelectionContainer" class="w-full h-full pb-2">
						</div>
					</div>

					<!-- Step 3: Basic Info -->
					<div id="step-3"
						class="wizard-step absolute inset-0 p-8 flex flex-col hidden overflow-y-auto custom-scrollbar">
						<div class="space-y-6">
							<div class="space-y-2" id="titleContainer">
								<div class="flex items-center justify-between">
									<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Title
										<span class="text-red-500">*</span></label>
									<button type="button"
										onclick="window.openExternalSearchModal(document.getElementById('type').value)"
										class="flex items-center gap-1.5 px-3 py-1.5 bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-500 rounded-lg text-xs font-bold transition-all group">
										<i data-lucide="globe"
											class="w-3.5 h-3.5 group-hover:rotate-12 transition-transform"></i>
										Search Online
									</button>
								</div>
								<input type="text" id="title" required
									class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-5 py-4 text-xl font-heading font-bold text-zinc-900 dark:text-white outline-none focus:border-zinc-400 dark:focus:border-white/20 focus:ring-1 focus:ring-zinc-400 dark:focus:ring-white/20 placeholder:text-zinc-400 dark:placeholder:text-zinc-700 transition-all"
									placeholder="Enter title...">
								<div id="duplicateWarning"
									class="hidden flex items-center gap-2 mt-2 px-3 py-2 bg-amber-500/10 border border-amber-500/20 rounded-lg text-amber-600 dark:text-amber-500 animate-enter">
									<i data-lucide="alert-circle" class="w-4 h-4 shrink-0"></i>
									<span class="text-xs font-bold" id="duplicateWarningText"></span>
								</div>
							</div>

							<div class="space-y-2">
								<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Alternate
									Titles <span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-3 flex flex-wrap gap-2 min-h-[54px] focus-within:border-zinc-400 dark:focus-within:border-zinc-600 focus-within:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all"
									id="altTitleTagsContainer">
									<input id="altTitleInput"
										class="bg-transparent text-sm outline-none flex-1 min-w-[80px] text-zinc-700 dark:text-zinc-200 p-1 placeholder-zinc-400"
										placeholder="Type & Enter...">
								</div>
							</div>

							<!-- Abbreviations / Shortcuts -->
							<div class="space-y-2">
								<label
									class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Abbreviations
									/ Shortcuts <span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<div class="flex gap-3">
									<label
										class="flex items-center justify-center bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 min-h-[54px] cursor-pointer group hover:border-zinc-400 dark:hover:border-zinc-600 transition-all"
										title="Disable Auto-Fill">
										<input type="checkbox" id="disableAbbr" checked
											class="w-4 h-4 rounded border-zinc-300 text-indigo-600 focus:ring-indigo-500 transition-all"
											onchange="toggleAbbrField(this.checked)">
										<span
											class="ml-2 text-[10px] font-bold text-zinc-400 group-hover:text-zinc-600 dark:group-hover:text-zinc-300 uppercase tracking-wider transition-colors hidden sm:inline-block">Disable
											Auto-Fill</span>
									</label>

									<div class="flex-1 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-3 flex flex-wrap gap-2 min-h-[54px] focus-within:border-zinc-400 dark:focus-within:border-zinc-600 focus-within:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all"
										id="abbrTagsContainer">
										<input id="abbrInput"
											class="bg-transparent text-sm outline-none flex-1 min-w-[80px] text-zinc-700 dark:text-zinc-200 p-1 placeholder-zinc-400 shadow-none border-none ring-0"
											placeholder="Auto-filled from title...">
									</div>
								</div>
							</div>

							<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
								<div class="space-y-2">
									<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Authors
										/ Studios <span
											class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
									<div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-3 flex flex-wrap gap-2 min-h-[54px] focus-within:border-zinc-400 dark:focus-within:border-zinc-600 focus-within:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all"
										id="authorTagsContainer">
										<input id="authorInput" list="authorOptions"
											class="bg-transparent text-sm outline-none flex-1 min-w-[80px] text-zinc-700 dark:text-zinc-200 p-1 placeholder-zinc-400"
											placeholder="Type & Enter...">
									</div>
									<p class="text-[10px] text-zinc-400 ml-1">Creators, authors, or studios</p>
								</div>

								<div class="space-y-2">
									<label
										class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Universe
										<span
											class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
									<input type="text" id="universe" list="universeOptions"
										class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-zinc-400 dark:focus:border-zinc-600 focus:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all placeholder-zinc-400"
										placeholder="e.g. MCU, Cosmere">
									<p class="text-[10px] text-zinc-400 ml-1">Shared fictional universe</p>
								</div>
							</div>

							<!-- Tags Field (Full Row) -->
							<div class="space-y-2">
								<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Tags
									<span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<div class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl p-3 flex flex-wrap gap-2 min-h-[54px] focus-within:border-zinc-400 dark:focus-within:border-zinc-600 focus-within:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all"
									id="tagTagsContainer">
									<input id="tagInput" list="tagOptions"
										class="bg-transparent text-sm outline-none flex-1 min-w-[80px] text-zinc-700 dark:text-zinc-200 p-1 placeholder-zinc-400"
										placeholder="Add Tags...">
								</div>
								<p class="text-[10px] text-zinc-400 ml-1">Genres, themes, or personal categories for
									filtering</p>
							</div>

							<!-- Release Date Field -->
							<div class="space-y-2" id="releaseDateContainer">
								<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Release
									Date <span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<div class="relative">
									<input type="date" id="releaseDate"
										class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-zinc-400 dark:focus:border-zinc-600 focus:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 transition-all placeholder-zinc-400 dark:[color-scheme:dark]"
										placeholder="Select date...">
								</div>
								<div class="flex flex-col gap-0.5 ml-1">
									<p class="text-[10px] text-zinc-400">When this media was first released</p>
									<p class="text-[10px] text-zinc-400 italic">Defaults to Jan 1st if only year is
										known</p>
								</div>
							</div>


							<div id="seriesWrapper" class="hidden space-y-2">
								<label
									class="text-xs font-bold text-emerald-600 dark:text-emerald-500 uppercase tracking-wider ml-1">Series
									/
									Collection <span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<div class="flex gap-4">
									<input type="text" id="series" list="seriesOptions"
										class="flex-1 bg-white dark:bg-zinc-900 border border-emerald-500/30 dark:border-emerald-900/40 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder-zinc-400"
										placeholder="Series Name">
									<input type="text" id="seriesNumber"
										class="w-24 bg-white dark:bg-zinc-900 border border-emerald-500/30 dark:border-emerald-900/40 rounded-xl px-2 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 text-center transition-all placeholder-zinc-400"
										placeholder="# Vol">
								</div>
							</div>

							<input type="hidden" id="itemId">
						</div>
					</div>

					<!-- Step 4: Cover Image -->
					<div id="step-4"
						class="wizard-step absolute inset-0 p-8 flex flex-col items-center justify-center text-center space-y-6 hidden">

						<div id="imageUploadArea" class="w-full max-w-md space-y-4 animate-enter px-4">
							<div id="dropZone"
								class="w-full h-80 bg-white dark:bg-zinc-900 border-2 border-dashed border-zinc-300 dark:border-zinc-700 rounded-3xl mx-auto flex flex-col items-center justify-center gap-4 relative group cursor-pointer transition-all hover:border-indigo-500 hover:bg-indigo-50 dark:hover:bg-indigo-500/10 hover:scale-[1.02]"
								onclick="document.getElementById('coverImage').click()"
								ondragover="window.handleDragOver(event)" ondragleave="window.handleDragLeave(event)"
								ondrop="window.handleDrop(event)">

								<input type="file" id="coverImage" accept="image/*" class="hidden"
									onchange="window.handleFileSelect(this)">

								<div id="previewPlaceholder"
									class="flex flex-col items-center gap-4 text-zinc-400 dark:text-zinc-500 group-hover:text-indigo-500 transition-colors pointer-events-none">
									<div
										class="p-4 rounded-full bg-zinc-100 dark:bg-zinc-800 group-hover:bg-indigo-100 dark:group-hover:bg-indigo-500/20 transition-colors">
										<i data-lucide="upload-cloud" class="w-10 h-10"></i>
									</div>
									<div class="space-y-1">
										<h4
											class="text-sm font-bold uppercase tracking-wider text-zinc-600 dark:text-zinc-300">
											Click, Drag or Paste Image
										</h4>
										<p class="text-[10px] text-zinc-400">Supports JPG, PNG, WEBP (Ctrl+V)</p>
									</div>
								</div>

								<!-- Existing Preview (If re-editing) -->
								<img id="previewImg" src=""
									class="absolute inset-0 w-full h-full object-contain p-4 hidden rounded-3xl">
							</div>

							<div class="flex justify-between items-center px-2">
								<div id="currentCoverName"
									class="text-xs text-zinc-400 font-mono truncate max-w-[200px]"></div>
								<button type="button" onclick="document.getElementById('coverImage').click()"
									class="text-xs font-bold text-indigo-500 hover:text-indigo-600">
									Browse Files
								</button>
							</div>
						</div>

						<div id="imageEditorArea" class="w-full h-full flex flex-col hidden animate-enter">
							<!-- Canvas Container -->
							<div
								class="flex-1 bg-zinc-950 rounded-2xl overflow-hidden relative border border-zinc-800 shadow-inner mb-4 w-full flex items-center justify-center min-h-0">
								<canvas id="editorCanvas" class="max-w-full max-h-full cursor-move"></canvas>

								<!-- Floating Controls Top Right -->
								<div class="absolute top-4 right-4 flex flex-col gap-2">
									<button type="button" onclick="window.imageEditor.closeEditor()"
										class="p-2 rounded-lg bg-black/50 hover:bg-black/70 text-white backdrop-blur-sm transition-colors text-xs font-bold flex items-center gap-2 border border-white/10 w-full justify-center">
										<i data-lucide="x" class="w-3 h-3"></i> Cancel
									</button>
									<button type="button" onclick="window.imageEditor.resetTransform()"
										class="p-2 rounded-lg bg-black/50 hover:bg-black/70 text-white backdrop-blur-sm transition-colors text-xs font-bold flex items-center gap-2 border border-white/10 w-full justify-center">
										<i data-lucide="refresh-ccw" class="w-3 h-3"></i> Reset
									</button>
								</div>

								<!-- Resolution Warning Overlay -->
								<div id="resolutionWarning"
									class="absolute bottom-4 left-4 right-4 bg-amber-500/90 dark:bg-amber-600/90 backdrop-blur-md text-white px-4 py-2 rounded-xl border border-white/20 shadow-lg flex items-center gap-3 animate-enter hidden z-10">
									<i data-lucide="alert-triangle" class="w-4 h-4 shrink-0"></i>
									<span class="text-[10px] font-bold uppercase tracking-tight warning-text">Low
										Resolution: Source provides only 300px for a 600px output.</span>
								</div>
							</div>

							<!-- Toolbar (Bottom) -->
							<div
								class="bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-2xl p-4 flex flex-col gap-4 shadow-xl shrink-0 text-left">

								<!-- Zoom (Primary Control) -->
								<div class="flex items-center gap-3 w-full">
									<i data-lucide="minus" class="w-4 h-4 text-zinc-400"></i>
									<input type="range" id="zoomSlider" min="0" max="100" value="0" step="1"
										class="w-full accent-indigo-500 h-1.5 bg-zinc-200 dark:bg-zinc-700 rounded-lg appearance-none cursor-pointer"
										oninput="window.imageEditor.setZoomFromSlider(this.value)">
									<i data-lucide="plus" class="w-4 h-4 text-zinc-400"></i>
								</div>

								<!-- Advanced Options (Collapsible) -->
								<details class="group border-t border-zinc-100 dark:border-zinc-800 pt-2">
									<summary
										class="list-none flex justify-between items-center cursor-pointer text-xs font-bold text-zinc-500 hover:text-indigo-500 dark:text-zinc-400 dark:hover:text-indigo-400 transition-colors select-none py-1">
										<span>Advanced Options</span>
										<i data-lucide="chevron-down"
											class="w-4 h-4 transition-transform group-open:rotate-180"></i>
									</summary>

									<div class="grid grid-cols-2 gap-4 mt-3 animate-enter">
										<!-- Format -->
										<div class="space-y-1">
											<label
												class="text-[10px] font-bold uppercase text-zinc-400 tracking-wider">Output
												Format</label>
											<select id="editorFormatSelect"
												onchange="window.imageEditor.setFormat(this.value)"
												class="w-full bg-zinc-100 dark:bg-zinc-800 border-none rounded-lg text-xs font-bold text-zinc-700 dark:text-zinc-300 py-2 px-3 cursor-pointer focus:ring-2 focus:ring-indigo-500">
												<option value="image/jpeg">JPEG (Universal)</option>
												<option value="image/webp">WebP (Modern/Small)</option>
												<option value="image/avif">AVIF (Next-Gen/Tiny)</option>
												<option value="image/png">PNG (Lossless/Heavy)</option>
											</select>
										</div>

										<!-- Resolution -->
										<div class="space-y-1">
											<label
												class="text-[10px] font-bold uppercase text-zinc-400 tracking-wider">Output
												Size</label>
											<select id="resolutionSelect"
												class="w-full bg-zinc-100 dark:bg-zinc-800 border-none rounded-lg text-xs font-bold text-zinc-700 dark:text-zinc-300 py-2 px-3 cursor-pointer focus:ring-2 focus:ring-indigo-500"
												onchange="window.imageEditor.setTargetWidth(parseInt(this.value))">
												<option value="400">Small (400px)</option>
												<option value="600">Medium (600px - Standard)</option>
												<option value="800" selected>800px (Recommended)</option>
												<option value="1000">Extra Large (1000px)</option>
												<option value="1200">High (1200px - Retina)</option>
											</select>
										</div>
									</div>
								</details>
							</div>
						</div>
					</div>

					<!-- Step 5: Description -->
					<div id="step-5" class="wizard-step absolute inset-0 p-8 flex flex-col hidden">
						<h3
							class="edit-only-header hidden text-lg font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-4">
							Description</h3>
						<textarea id="description" rows="12"
							class="flex-1 w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-5 py-4 text-zinc-700 dark:text-zinc-300 outline-none focus:border-zinc-400 dark:focus:border-zinc-600 focus:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 resize-none custom-scrollbar transition-all leading-relaxed text-lg placeholder:text-zinc-400"
							placeholder="What is this about? (Optional)"></textarea>
					</div>

					<!-- Step 6: External Links -->
					<div id="step-6"
						class="wizard-step absolute inset-0 p-8 flex flex-col hidden overflow-y-auto custom-scrollbar">
						<h3
							class="edit-only-header hidden text-lg font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-4">
							External Links</h3>
						<div class="space-y-6">
							<div id="dynamicLinkButtons" class="flex flex-wrap gap-3 mb-6"></div>

							<div
								class="flex justify-between items-center ml-1 border-b border-zinc-200 dark:border-zinc-800 pb-2">
								<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider">Added
									Links <span
										class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
								<button type="button" onclick="addLink()"
									class="text-xs text-indigo-500 dark:text-indigo-400 hover:text-indigo-600 dark:hover:text-indigo-300 flex items-center gap-1 font-bold"><i
										data-lucide="plus" class="w-3 h-3"></i> Custom Link</button>
							</div>
							<div id="linksContainer" class="space-y-3"></div>
							<datalist id="linkNameOptions">
								<option value="MyAnimeList"></option>
								<option value="CSFD"></option>
								<option value="IMDB"></option>
								<option value="Wikipedia"></option>
								<option value="Fandom"></option>
								<option value="Goodreads"></option>
							</datalist>
						</div>
					</div>

					<!-- Step 7: Current Progress -->
					<div id="step-7"
						class="wizard-step absolute inset-0 p-8 flex flex-col items-center justify-center text-center space-y-8 hidden overflow-y-auto custom-scrollbar">
						<div class="space-y-4 w-full max-w-md">
							<label
								class="text-xs font-bold text-amber-600 dark:text-amber-500 uppercase tracking-wider ml-1">Current
								Progress <span
									class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
							<input type="text" id="progress"
								class="w-full bg-white dark:bg-zinc-900 border border-amber-500/30 dark:border-amber-900/40 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition-all font-mono text-center text-lg placeholder-zinc-400"
								placeholder="e.g. Ch10, S2, V1, S2E1...">
							<p class="text-xs text-zinc-500" id="progressHelp">Where you left off (Next
								chapter/volume/season/episode to continue from)</p>
						</div>
					</div>

					<!-- Step 8: Review & Rating -->
					<div id="step-8"
						class="wizard-step absolute inset-0 p-8 flex flex-col hidden overflow-y-auto custom-scrollbar">
						<div id="reviewWrapper" class="flex-1 flex flex-col w-full mb-8">
							<label
								class="text-xs font-bold text-indigo-500 dark:text-indigo-400 uppercase tracking-wider mb-2">Personal
								Review <span
									class="text-zinc-400 dark:text-zinc-600 font-normal normal-case">(Optional)</span></label>
							<textarea id="review"
								class="flex-1 w-full bg-white dark:bg-zinc-900 border border-indigo-200 dark:border-indigo-900/40 rounded-xl px-5 py-4 text-zinc-700 dark:text-zinc-300 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 resize-none custom-scrollbar transition-all placeholder:text-zinc-400 dark:placeholder:text-zinc-700"
								placeholder="Write your comprehensive review..."></textarea>
						</div>

						<div class="space-y-8 w-full">
							<!-- Rating Visual Component -->
							<div class="relative w-full pt-6 pb-2">
								<!-- Star Legend -->
								<div class="grid grid-cols-4 px-0 mb-2 w-full">
									<div class="flex justify-center items-center">
										<i data-lucide="star" class="w-4 h-4 text-red-500 fill-red-500"></i>
									</div>
									<div class="flex justify-center items-center">
										<div class="flex gap-0.5">
											<i data-lucide="star" class="w-4 h-4 text-amber-500 fill-amber-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-amber-500 fill-amber-500"></i>
										</div>
									</div>
									<div class="flex justify-center items-center">
										<div class="flex gap-0.5">
											<i data-lucide="star" class="w-4 h-4 text-blue-500 fill-blue-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-blue-500 fill-blue-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-blue-500 fill-blue-500"></i>
										</div>
									</div>
									<div class="flex justify-center items-center">
										<div class="flex gap-0.5">
											<i data-lucide="star" class="w-4 h-4 text-emerald-500 fill-emerald-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-emerald-500 fill-emerald-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-emerald-500 fill-emerald-500"></i>
											<i data-lucide="star" class="w-4 h-4 text-emerald-500 fill-emerald-500"></i>
										</div>
									</div>
								</div>

								<!-- Slider Container -->
								<div class="relative w-full h-4 mt-2">
									<!-- Custom Track Background -->
									<div
										class="absolute inset-0 w-full h-4 rounded-full overflow-hidden flex opacity-30 pointer-events-none">
										<div class="flex-1 bg-red-500"></div>
										<div class="flex-1 bg-amber-500"></div>
										<div class="flex-1 bg-blue-500"></div>
										<div class="flex-1 bg-emerald-500"></div>
									</div>

									<!-- Slider Input -->
									<input type="range" id="rating" min="1" max="4" step="1" value="2"
										class="relative z-10 w-[75%] mx-auto block h-4 bg-transparent rounded-full appearance-none cursor-pointer accent-amber-500 focus:outline-none">
								</div>
							</div>

							<!-- Dynamic Label -->
							<div class="text-center">
								<div id="ratingLabel"
									class="text-4xl font-black uppercase text-amber-500 dark:text-amber-400 tracking-tighter drop-shadow-2xl transition-all transform hover:scale-105">
									Ok</div>
							</div>

							<!-- Additional Tracking Info -->
							<div
								class="flex flex-col sm:flex-row gap-4 pt-4 border-t border-zinc-100 dark:border-zinc-800/40">
								<div class="flex-1 space-y-2" id="rereadCountContainer">
									<label
										class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1 block text-center">Reread
										Count</label>
									<div class="flex items-center justify-center gap-2">
										<button type="button" onclick="window.decrementRereadCount()"
											class="w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded-lg text-zinc-600 dark:text-zinc-300 transition-colors text-xl font-bold">
											âˆ’
										</button>
										<input type="number" id="rereadCount" min="0" value="0"
											class="w-20 bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-3 py-2.5 text-zinc-700 dark:text-zinc-200 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all text-center font-bold text-lg">
										<button type="button" onclick="window.incrementRereadCount()"
											class="w-10 h-10 flex items-center justify-center bg-zinc-100 dark:bg-zinc-800 hover:bg-zinc-200 dark:hover:bg-zinc-700 rounded-lg text-zinc-600 dark:text-zinc-300 transition-colors text-xl font-bold">
											+
										</button>
									</div>
									<p class="text-[10px] text-zinc-400 text-center">Times re-consumed</p>
								</div>
								<div class="flex-1 space-y-2" id="completedAtContainer">
									<label
										class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1 block text-center">Completed
										Date</label>
									<div class="flex justify-center">
										<input type="date" id="completedAt"
											class="w-full max-w-[200px] bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 py-2.5 text-zinc-700 dark:text-zinc-200 outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all dark:[color-scheme:dark] text-center">
									</div>
									<p class="text-[10px] text-zinc-400 text-center">When you finished it</p>
								</div>
							</div>

						</div>
					</div>

					<!-- Step 9: Notes -->
					<div id="step-9" class="wizard-step absolute inset-0 p-8 flex flex-col hidden">
						<h3
							class="edit-only-header hidden text-lg font-bold text-zinc-500 dark:text-zinc-400 uppercase tracking-widest mb-4">
							Notes</h3>
						<textarea id="notes" rows="12"
							class="flex-1 w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-5 py-4 text-zinc-700 dark:text-zinc-300 outline-none focus:border-zinc-400 dark:focus:border-zinc-600 focus:ring-1 focus:ring-zinc-400 dark:focus:ring-zinc-600 resize-none custom-scrollbar transition-all leading-relaxed font-mono text-sm placeholder:text-zinc-400"
							placeholder="Private notes, reminders, or details... (Optional)"></textarea>
					</div>

					<!-- Step 10: Seasons/Volumes/Stats -->
					<div id="step-10"
						class="wizard-step absolute inset-0 p-8 flex flex-col hidden overflow-y-auto custom-scrollbar">
						<div class="flex justify-between items-center mb-6">
							<h3
								class="text-2xl font-heading font-bold text-zinc-900 dark:text-white flex items-center gap-3">
								<i data-lucide="layers" class="w-6 h-6 text-zinc-400 dark:text-zinc-600"></i>
								<span id="childLabel">Seasons & Stats</span>
							</h3>
							<button type="button" id="addChildBtn" onclick="addChild()"
								class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all shadow-lg flex items-center gap-2"><i
									data-lucide="plus" class="w-4 h-4"></i> Add New</button>
						</div>

						<div id="childrenWrapper"
							class="bg-zinc-100 dark:bg-zinc-900/50 border border-zinc-200 dark:border-zinc-800 rounded-xl p-4">
							<div id="childrenContainer" class="space-y-3">
							</div>
						</div>

						<!-- Calculated Totals -->
						<div id="childrenTotalsContainer"
							class="mt-4 p-4 bg-zinc-50 dark:bg-zinc-900/30 border border-zinc-200 dark:border-zinc-800 rounded-xl">
							<div class="flex items-center justify-between mb-3">
								<span class="text-xs font-bold text-zinc-400 uppercase tracking-wider">Calculated
									Totals</span>
								<label class="flex items-center gap-2 cursor-pointer text-xs text-zinc-500">
									<input type="checkbox" id="overrideTotals"
										class="w-3.5 h-3.5 rounded border-zinc-300 text-indigo-500 focus:ring-indigo-500"
										onchange="window.toggleTotalsOverride(this.checked)">
									<span>Manual Override</span>
								</label>
							</div>
							<div class="grid grid-cols-2 gap-3" id="totalsGrid">
								<div class="space-y-1 series-total">
									<label
										class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1">Total
										Episodes</label>
									<input type="number" id="episodeCount" min="0" readonly
										oninput="window.syncTotalsToChild('episodes', parseInt(this.value))"
										class="w-full bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-500 dark:text-zinc-400 outline-none transition-all placeholder-zinc-400"
										placeholder="Auto">
								</div>
								<div class="space-y-1 duration-total">
									<label id="durationLabel"
										class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1">Total
										Duration (min)</label>
									<input type="number" id="avgDurationMinutes" min="0" readonly
										oninput="window.syncTotalsToChild('duration', parseInt(this.value))"
										class="w-full bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-500 dark:text-zinc-400 outline-none transition-all placeholder-zinc-400"
										placeholder="Auto">
								</div>
								<div class="space-y-1 reading-total hidden">
									<label
										class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1">Total
										Chapters</label>
									<input type="number" id="chapterCount" min="0" readonly
										oninput="window.syncTotalsToChild('chapters', parseInt(this.value))"
										class="w-full bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-500 dark:text-zinc-400 outline-none transition-all placeholder-zinc-400"
										placeholder="Auto">
								</div>
								<div class="space-y-1 book-only-total hidden">
									<label
										class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1">Total
										Words</label>
									<input type="number" id="wordCount" min="0" readonly
										oninput="window.syncTotalsToChild('words', parseInt(this.value))"
										class="w-full bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-500 dark:text-zinc-400 outline-none transition-all placeholder-zinc-400"
										placeholder="Auto">
								</div>
								<div class="space-y-1 col-span-2">
									<label class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider ml-1"
										id="volumeCountLabel">Total Seasons</label>
									<input type="number" id="volumeCount" min="0" readonly
										class="w-full bg-zinc-100 dark:bg-zinc-800 border border-zinc-200 dark:border-zinc-700 rounded-lg px-3 py-2 text-sm text-zinc-500 dark:text-zinc-400 outline-none transition-all placeholder-zinc-400"
										placeholder="Auto">
								</div>
							</div>
						</div>
					</div>

					<!-- Step 11: Privacy Setting -->
					<div id="step-11"
						class="wizard-step absolute inset-0 p-8 flex flex-col items-center justify-center text-center space-y-8 hidden">
						<div class="space-y-6 w-full max-w-sm">
							<label for="isHidden"
								class="p-6 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex flex-col items-center gap-4 cursor-pointer hover:border-red-500/50 hover:bg-red-500/5 transition-all group shadow-xl">
								<div class="flex items-center gap-4 pointer-events-none">
									<input type="checkbox" id="isHidden"
										class="h-6 w-6 rounded border-zinc-300 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800 text-red-500 focus:ring-red-500 transition-all pointer-events-auto">
									<span
										class="text-xl font-bold text-zinc-700 dark:text-zinc-300 group-hover:text-red-500 dark:group-hover:text-red-400 select-none">Mark
										as Hidden</span>
								</div>
								<p class="text-xs text-zinc-500 px-4 pointer-events-none">Hidden items are excluded
									from
									the public grid view by default.</p>
							</label>
						</div>
					</div>

					<!-- Step 12: Calendar Event Setup -->
					<div id="step-12"
						class="wizard-step absolute inset-0 p-8 flex flex-col items-center justify-center text-center space-y-8 hidden overflow-y-auto custom-scrollbar">
						<div class="space-y-6 w-full max-w-lg mx-auto">
							<div class="flex flex-col items-center gap-6 mb-8">
								<label for="addToCalendar"
									class="w-full p-6 rounded-2xl bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 flex flex-col items-center gap-4 cursor-pointer hover:border-emerald-500/50 hover:bg-emerald-500/5 transition-all group shadow-xl">
									<div class="flex items-center gap-4 pointer-events-none">
										<input type="checkbox" id="addToCalendar"
											class="h-6 w-6 rounded border-zinc-300 dark:border-zinc-700 bg-zinc-100 dark:bg-zinc-800 text-emerald-500 focus:ring-emerald-500 transition-all pointer-events-auto"
											onchange="window.toggleCalendarFields(this.checked)">
										<span
											class="text-xl font-bold text-zinc-700 dark:text-zinc-300 group-hover:text-emerald-500 dark:group-hover:text-emerald-400 select-none">Add
											to Calendar</span>
									</div>
									<p class="text-xs text-zinc-500 pointer-events-none">Create release events for this
										item</p>
								</label>
							</div>

							<!-- Calendar Fields (Hidden by default) -->
							<div id="calendarFields"
								class="hidden space-y-6 text-left bg-zinc-50 dark:bg-zinc-900/50 p-6 rounded-2xl border border-zinc-200 dark:border-zinc-800 animate-enter">
								<!-- Date -->
								<div class="space-y-2">
									<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Event
										Start Date <span class="text-red-500">*</span></label>
									<input type="date" id="calDate"
										class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all dark:[color-scheme:dark]">
								</div>

								<!-- Content -->
								<div class="space-y-2">
									<label class="text-xs font-bold text-zinc-500 uppercase tracking-wider ml-1">Event
										Note <span
											class="text-zinc-400 font-normal normal-case">(Optional)</span></label>
									<input type="text" id="calContent"
										class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-xl px-4 py-3 text-zinc-700 dark:text-zinc-200 outline-none focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 transition-all placeholder-zinc-400"
										placeholder="e.g. Season Premiere, New Chapter">
								</div>

								<!-- Recurrence Toggle -->
								<div class="pt-4 border-t border-zinc-200 dark:border-zinc-800">
									<label class="flex items-center gap-3 cursor-pointer">
										<input type="checkbox" id="calRecurring"
											class="w-5 h-5 rounded border-zinc-300 text-emerald-500 focus:ring-emerald-500"
											onchange="window.toggleRecurrenceFields(this.checked)">
										<span class="text-sm font-bold text-zinc-700 dark:text-zinc-300">Recurring
											Release Schedule</span>
									</label>
								</div>

								<!-- Recurrence Fields -->
								<div id="calRecurrenceFields"
									class="hidden pl-4 border-l-2 border-emerald-500/20 space-y-4 pt-2">
									<div class="space-y-2">
										<label
											class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider">Frequency</label>
										<select id="calFreq"
											class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm px-3 py-2 outline-none">
											<option value="weekly" selected>Weekly</option>
											<option value="daily">Daily</option>
										</select>
									</div>
									<div class="space-y-2">
										<label
											class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider">Number
											of Releases</label>
										<input type="number" id="calCount" min="1" value="12"
											class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm px-3 py-2 outline-none">
									</div>

									<div class="space-y-3 pt-2">
										<label class="flex items-center gap-2 cursor-pointer">
											<input type="checkbox" id="calUseCounter"
												class="w-4 h-4 rounded border-zinc-300 text-emerald-500" checked
												onchange="document.getElementById('calPrefixWrapper').classList.toggle('hidden', !this.checked)">
											<span
												class="text-xs font-bold text-zinc-500 hover:text-emerald-500 transition-colors">Auto-Numbering
												(e.g. Episode 1, 2...)</span>
										</label>

										<div id="calPrefixWrapper" class="grid grid-cols-2 gap-3">
											<div class="space-y-1">
												<label
													class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider">Prefix</label>
												<input type="text" id="calPrefix"
													class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm px-3 py-2 outline-none"
													placeholder="Ep">
											</div>
											<div class="space-y-1">
												<label
													class="text-[10px] font-bold text-zinc-400 uppercase tracking-wider">Start
													#</label>
												<input type="number" id="calStartCount" min="1" value="1"
													class="w-full bg-white dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-700 rounded-lg text-sm px-3 py-2 outline-none">
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Datalists for Autocomplete -->
					<datalist id="authorOptions"></datalist>
					<datalist id="tagOptions"></datalist>
					<datalist id="universeOptions"></datalist>
					<datalist id="seriesOptions"></datalist>

				</form>
			</div>
		</div>

		<!-- Wizard Footer Navigation -->
		<div
			class="px-8 py-5 border-t border-zinc-200 dark:border-zinc-800 flex justify-between items-center bg-white dark:bg-[#0c0c0e] relative z-50">
			<div class="flex gap-2 w-16 invisible"> <!-- Placeholder to balance layout -->
				<span id="stepIndicator" class="text-xs font-mono text-zinc-600 font-bold"></span>
			</div>

			<!-- Centered Dots Container -->
			<div id="wizardDots" class="absolute left-1/2 -translate-x-1/2 flex gap-3"></div>

			<div class="flex gap-3">
				<button type="button" id="prevBtn" onclick="prevStep()"
					class="hidden px-6 py-2.5 text-zinc-500 dark:text-zinc-400 hover:text-zinc-900 dark:hover:text-white text-sm font-bold transition-colors">Back</button>
				<button type="button" id="nextBtn" onclick="nextStep()"
					class="bg-zinc-900 dark:bg-white text-white dark:text-black hover:bg-zinc-700 dark:hover:bg-zinc-200 px-8 py-2.5 rounded-xl font-bold shadow-lg shadow-black/10 dark:shadow-white/10 text-sm active:scale-95 transition-all">Next</button>
				<button type="button" id="submitBtn" onclick="saveEntry()"
					class="hidden bg-zinc-900 dark:bg-white text-white dark:text-black hover:bg-zinc-700 dark:hover:bg-zinc-200 px-8 py-2.5 rounded-xl font-bold shadow-lg shadow-black/10 dark:shadow-white/10 text-sm active:scale-95 transition-all">Finish</button>
			</div>
		</div>
	</div>
</div>